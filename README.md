# Тестовое задание от BIOCAD

## Кейс

Необходимо создать сервис на языке Go, реализующий следующие функции:
- [x] Брать конфигурации для соединения с БД 
- [x] Брать конфигурации для указания пути к директории с данными
- [x] Периодически осматривать директорию на наличие новых не обработанных файлов (.tsv)
- [x] Держать в базе список уже обработанных файлов
- [x] Обработку файлов ставить в очередь
- [x] Парсить .tsv файлы в структуру
- [x] Класть данные в БД
- [x] После обработки файла генерировать PDF документ с полученными данными
- [x] Ошибки парсинга записывать в БД
- [x] Выходные файлы распологать в отдельной директории
- [x] API интерфейс для получения данных из БД с пагинацией (page/limit)

## Структура проекта


    .
    ├── api             # Postman коллекция
    ├── cmd
    │   └── main        # Точка входа в приложение
    ├── internal
    │   ├── app         # Настройки приложения
    │   ├── config      # Парсинг переменных окружения (Подключение к БД, директории)
    │   ├── controller
    │   │   └── http
    │   │       └── v1  # Endpoints
    │   ├── entity      # Сущности для работы с БД
    │   └── usecase     # Бизнес-логика приложения
    │       └── repo    # Запросы к БД
    ├── migrations      # SQL-запросы для инициализации и тестирования БД
    ├── pkg
    │   ├── httpserver  # Конфигурации для работы с HTTP сервером
    │   └── postgres    # Конфигурации для подключения к БД
    └── resources
        ├── fonts       # Шрифты для генерации PDF
        ├── pdf         # Тест-директория для сохранения PDF
        └── testData    # Тест-директория для тестовых данных

## Используемые технологии

- PostgreSQL драйвер и набор инструментов для Go: [`pgx`](https://pkg.go.dev/github.com/jackc/pgx/v5)
- Роутер для построения HTTP запросов: [`Chi router`](https://pkg.go.dev/github.com/go-chi/chi)
- База данных: [`PostgreSQL 14`](https://www.postgresql.org/)
- Генератор PDF документов: [`gopdf`](https://github.com/signintech/gopdf)
- Парсер и маппер структур для TSV документов [`TSV parser for Go`](https://github.com/dogenzaka/tsv)
- Конструкток SQL запросов [`Squirrel`](https://github.com/Masterminds/squirrel)
- Документация:
    - [`Postman`](https://www.postman.com/)
        - [Postman файл](api/biocad.postman_collection.json) с эндпоинтами для тестирования приложения
- Контейнеризация:
    - [`Docker 20.10.21`](https://www.docker.com/) - ссылка на [Dockerfile](Dockerfile) приложения:
        - Использован multi-stage build для разделения процесса сборки
    - [`docker-compose 1.29.2`](https://docs.docker.com/compose/) - для автоматического поднятия окружения: базы данных и приложения:
        - сервис `biocad_psql` (порт 5432) - Контейнер базы данных на основе легковесного образа linux alpine
        - сервис `server` (порт 9000) - Разработанное приложение
- `GNU make 4.3`

## Запуск приложения

### С использованием Makefile

Запуск:
```bash
make
```

Сборка:
```bash
make build
```

Пересборка приложения:
```bash
make rebuild
```

Запуск только базы данных:
```bash
make db
```

Остановка работы сервиса:
```bash
make clean
```

### С использованием Docker Compose
```bash
docker-compose up --build
```

## Обратите внимание

Для корректной работы приложения необходимо указать перменные окружения. [Шаблон для заполнения](.env.example)
